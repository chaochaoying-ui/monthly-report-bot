# ğŸš€ éƒ¨ç½²å›¾è¡¨ä¸Šä¼ åŠŸèƒ½

## ğŸ“‹ æ›´æ–°å†…å®¹

âœ… **å·²ä¿®å¤çš„é—®é¢˜**ï¼š
- å›¾è¡¨ç”ŸæˆæˆåŠŸä½†åªæ˜¾ç¤ºæ–‡ä»¶åï¼Œæ— æ³•ç›´æ¥æŸ¥çœ‹
- ç”¨æˆ·æ”¶åˆ°"å›¾è¡¨æ–‡ä»¶: dashboard_20251022_153640.png"ä½†ä¸çŸ¥é“åœ¨å“ªé‡Œæ‰“å¼€

âœ… **æ–°å¢åŠŸèƒ½**ï¼š
- è‡ªåŠ¨ä¸Šä¼ å›¾è¡¨å›¾ç‰‡åˆ°é£ä¹¦
- åœ¨æ¶ˆæ¯ä¸­ç›´æ¥å±•ç¤ºç¾åŒ–çš„å›¾è¡¨
- åŒ…å«é‡‘é“¶é“œæ’è¡Œæ¦œçš„ç»¼åˆç»Ÿè®¡ä»ªè¡¨æ¿
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆ

---

## ğŸ”§ éƒ¨ç½²æ­¥éª¤

### 1ï¸âƒ£ ç™»å½• GCP æœåŠ¡å™¨

```bash
ssh hdi918072@<your-gcp-ip>
```

### 2ï¸âƒ£ è¿›å…¥é¡¹ç›®ç›®å½•å¹¶æ‹‰å–æœ€æ–°ä»£ç 

```bash
cd ~/monthly-report-bot/monthly_report_bot_link_pack
git pull origin main
```

### 3ï¸âƒ£ éªŒè¯æ›´æ–°å†…å®¹

```bash
# æŸ¥çœ‹æœ€æ–°æäº¤
git log -1 --oneline

# åº”è¯¥æ˜¾ç¤º: feat: æ·»åŠ å›¾è¡¨å›¾ç‰‡ä¸Šä¼ å’Œå±•ç¤ºåŠŸèƒ½
```

### 4ï¸âƒ£ æ£€æŸ¥ä¾èµ–ï¼ˆå·²å®‰è£…å¯è·³è¿‡ï¼‰

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# æ£€æŸ¥ä¾èµ–
python3 << 'EOF'
import matplotlib, seaborn, numpy
print("âœ… matplotlib:", matplotlib.__version__)
print("âœ… seaborn:", seaborn.__version__)
print("âœ… numpy:", numpy.__version__)
EOF
```

å¦‚æœä¾èµ–ç¼ºå¤±ï¼Œè¿è¡Œï¼š
```bash
pip install matplotlib seaborn numpy -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 5ï¸âƒ£ é‡å¯æœåŠ¡

```bash
# é‡å¯æœåŠ¡
sudo systemctl restart monthly-report-bot.service

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
sudo systemctl status monthly-report-bot.service
```

é¢„æœŸè¾“å‡ºï¼š
```
â— monthly-report-bot.service - Monthly Report Bot
   Loaded: loaded
   Active: active (running) since ...
```

### 6ï¸âƒ£ æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ

```bash
# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
tail -f ~/monthly-report-bot/monthly_report_bot_link_pack/monthly_report_bot_final.log
```

é¢„æœŸçœ‹åˆ°ï¼š
```
æœˆæŠ¥æœºå™¨äºº v1.3 äº¤äº’å¢å¼ºç‰ˆ - æ ¸å¿ƒåŠŸèƒ½ + Echo
...
INFO å®¢æˆ·ç«¯åˆå§‹åŒ–å®Œæˆ
```

---

## âœ… éªŒè¯éƒ¨ç½²

### æ–¹æ³•ä¸€ï¼šåœ¨é£ä¹¦ç¾¤èŠä¸­æµ‹è¯•

1. åœ¨é£ä¹¦ç¾¤èŠä¸­å‘é€ï¼š`å›¾è¡¨`
2. é¢„æœŸæ•ˆæœï¼š
   - æ”¶åˆ°ä¸€å¼ äº¤äº’å¼å¡ç‰‡
   - å¡ç‰‡æ ‡é¢˜ï¼šğŸ“Š ä»»åŠ¡ç»Ÿè®¡å›¾è¡¨
   - å¡ç‰‡å†…å®¹ï¼šç»Ÿè®¡æ•°æ® + ç¾åŒ–çš„å›¾è¡¨å›¾ç‰‡
   - å›¾è¡¨åŒ…å«ï¼šé¥¼çŠ¶å›¾ã€è¿›åº¦æ¡ã€é‡‘é“¶é“œæ’è¡Œæ¦œ

### æ–¹æ³•äºŒï¼šæ£€æŸ¥ç”Ÿæˆçš„å›¾è¡¨æ–‡ä»¶

```bash
cd ~/monthly-report-bot/monthly_report_bot_link_pack
ls -lht charts/*.png | head -3
```

---

## ğŸ¯ åŠŸèƒ½è¯´æ˜

### è§¦å‘å…³é”®è¯
åœ¨é£ä¹¦ç¾¤èŠä¸­å‘é€ä»¥ä¸‹ä»»ä¸€å…³é”®è¯å³å¯ç”Ÿæˆå›¾è¡¨ï¼š
- `å›¾è¡¨`
- `å¯è§†åŒ–`
- `é¥¼å›¾`
- `ç»Ÿè®¡å›¾`
- `å›¾è¡¨ç»Ÿè®¡`
- `chart`
- `visualization`
- `pie`
- `dashboard`

### è¿”å›å†…å®¹

**æˆåŠŸæ—¶**ï¼šè¿”å›åŒ…å«ä»¥ä¸‹å†…å®¹çš„äº¤äº’å¼å¡ç‰‡
- ğŸ“Š æ ‡é¢˜ï¼šä»»åŠ¡ç»Ÿè®¡å›¾è¡¨
- ğŸ“ˆ ç»Ÿè®¡æ•°æ®ï¼šæ€»ä»»åŠ¡æ•°ã€å·²å®Œæˆã€å¾…å®Œæˆã€å®Œæˆç‡
- ğŸ–¼ï¸ å›¾è¡¨å›¾ç‰‡ï¼šç»¼åˆç»Ÿè®¡ä»ªè¡¨æ¿
- ğŸ’¡ è¯´æ˜æ–‡å­—ï¼šå›¾è¡¨åŒ…å«å¤šç»´åº¦åˆ†æ

**å¤±è´¥æ—¶**ï¼šè¿”å›å‹å¥½çš„é”™è¯¯æç¤º
- ä¾èµ–ç¼ºå¤±ï¼šæç¤ºæ£€æŸ¥ä¾èµ–åº“å®‰è£…
- å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼šè¿”å›æ–‡æœ¬å½¢å¼çš„ç»Ÿè®¡æ•°æ®
- æ— ä»»åŠ¡æ•°æ®ï¼šæç¤ºå½“å‰æ²¡æœ‰ä»»åŠ¡

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæœåŠ¡æ— æ³•å¯åŠ¨

**æ£€æŸ¥æ—¥å¿—**ï¼š
```bash
sudo journalctl -u monthly-report-bot.service -n 50
```

**å¸¸è§åŸå› **ï¼š
- Python ä¾èµ–ç¼ºå¤±
- è™šæ‹Ÿç¯å¢ƒè·¯å¾„é”™è¯¯
- ç¯å¢ƒå˜é‡æœªè®¾ç½®

### é—®é¢˜ 2ï¼šå›¾è¡¨ä¸æ˜¾ç¤º

**æ£€æŸ¥**ï¼š
1. ä¾èµ–æ˜¯å¦å®‰è£…åœ¨è™šæ‹Ÿç¯å¢ƒä¸­
   ```bash
   source venv/bin/activate
   pip list | grep -E "matplotlib|seaborn|numpy"
   ```

2. å›¾è¡¨æ–‡ä»¶æ˜¯å¦ç”Ÿæˆ
   ```bash
   ls -la charts/
   ```

3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—
   ```bash
   tail -100 monthly_report_bot_final.log | grep -i "å›¾è¡¨\|chart\|image"
   ```

### é—®é¢˜ 3ï¼šå›¾ç‰‡ä¸Šä¼ å¤±è´¥

**å¯èƒ½åŸå› **ï¼š
- ç½‘ç»œè¿æ¥é—®é¢˜
- é£ä¹¦ API æƒé™ä¸è¶³
- å›¾ç‰‡æ–‡ä»¶è¿‡å¤§ï¼ˆ>10MBï¼‰

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æœåŠ¡å™¨ç½‘ç»œè¿æ¥
- ç¡®è®¤é£ä¹¦åº”ç”¨æƒé™åŒ…å« `im:message` å’Œ `im:image`
- æŸ¥çœ‹æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯

---

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### æ–°å¢ä»£ç ä½ç½®

**æ–‡ä»¶**ï¼š`monthly_report_bot_ws_v1.1.py`

**æ–°å¢å‡½æ•°**ï¼š
- `upload_image(image_path: str) -> Optional[str]`
  - åŠŸèƒ½ï¼šä¸Šä¼ å›¾ç‰‡åˆ°é£ä¹¦ï¼Œè¿”å› image_key
  - ä½ç½®ï¼šç¬¬ 773-807 è¡Œ

**ä¿®æ”¹å‡½æ•°**ï¼š
- `generate_chart_response() -> Tuple[Optional[str], Optional[Dict[str, Any]]]`
  - æ”¹åŠ¨ï¼šè¿”å› (chart_path, stats) å…ƒç»„è€Œéæ–‡æœ¬
  - ä½ç½®ï¼šç¬¬ 923-950 è¡Œ

- `handle_message_event(event: Dict[str, Any]) -> bool`
  - æ”¹åŠ¨ï¼šæ–°å¢å›¾è¡¨è¯·æ±‚å¤„ç†é€»è¾‘ï¼ˆä¸Šä¼ å›¾ç‰‡å¹¶å‘é€å¡ç‰‡ï¼‰
  - ä½ç½®ï¼šç¬¬ 1035-1114 è¡Œ

### ä½¿ç”¨çš„é£ä¹¦ API

- **CreateImageRequest**ï¼šä¸Šä¼ å›¾ç‰‡
  - API: `lark_client.im.v1.image.acreate()`
  - å‚æ•°ï¼šimage_type="message", image=äºŒè¿›åˆ¶æ•°æ®
  - è¿”å›ï¼šimage_key

- **ReplyMessageRequest**ï¼šå›å¤æ¶ˆæ¯
  - API: `lark_client.im.v1.message.areply()`
  - æ”¯æŒç±»å‹ï¼štextï¼ˆæ–‡æœ¬ï¼‰ã€interactiveï¼ˆå¡ç‰‡ï¼‰

### å¡ç‰‡ç»“æ„

```json
{
  "config": {"wide_screen_mode": true},
  "header": {
    "title": {"tag": "plain_text", "content": "ğŸ“Š ä»»åŠ¡ç»Ÿè®¡å›¾è¡¨"},
    "template": "blue"
  },
  "elements": [
    {
      "tag": "div",
      "text": {"tag": "lark_md", "content": "ç»Ÿè®¡æ•°æ®..."}
    },
    {
      "tag": "img",
      "img_key": "<image_key>",
      "alt": {"tag": "plain_text", "content": "ä»»åŠ¡ç»Ÿè®¡å›¾è¡¨"}
    },
    {
      "tag": "div",
      "text": {"tag": "lark_md", "content": "è¯´æ˜æ–‡å­—..."}
    }
  ]
}
```

---

## ğŸ‰ å®Œæˆï¼

éƒ¨ç½²å®Œæˆåï¼Œåœ¨é£ä¹¦ç¾¤èŠä¸­å‘é€"å›¾è¡¨"å³å¯çœ‹åˆ°ç¾åŒ–çš„ç»Ÿè®¡å›¾è¡¨ï¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
tail -100 ~/monthly-report-bot/monthly_report_bot_link_pack/monthly_report_bot_final.log
```
