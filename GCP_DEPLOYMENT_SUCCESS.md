# ğŸ‰ GCP éƒ¨ç½²æˆåŠŸæ€»ç»“

## éƒ¨ç½²ä¿¡æ¯

- **éƒ¨ç½²æ—¥æœŸ**: 2025-10-18
- **å¹³å°**: Google Cloud Platform (GCP) Compute Engine
- **å®ä¾‹ç±»å‹**: e2-micro (å…è´¹å±‚)
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 22.04 LTS
- **Python ç‰ˆæœ¬**: 3.11.0rc1
- **éƒ¨ç½²æ–¹å¼**: systemd åå°æœåŠ¡

## éƒ¨ç½²æ¶æ„å†³ç­–

### âœ… é€‰æ‹© GCP éƒ¨ç½²çš„åŸå› 

1. **24/7 åœ¨çº¿è¿è¡Œ**ï¼šæ— éœ€æœ¬åœ°ç”µè„‘ä¸€ç›´å¼€æœº
2. **WebSocket å®æ—¶å›å¤**ï¼šæ”¯æŒ `@æœºå™¨äºº` ç«‹å³å“åº”
3. **å®Œæ•´åŠŸèƒ½æ”¯æŒ**ï¼šå®šæ—¶ä»»åŠ¡ + å®æ—¶äº¤äº’
4. **å…è´¹é¢åº¦å……è¶³**ï¼še2-micro å®ä¾‹å…è´¹ä½¿ç”¨

### âŒ ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ GitHub Actions

1. **æ— æ³•å®æ—¶å›å¤**ï¼šGitHub Actions æ˜¯æ— çŠ¶æ€çš„ï¼Œæ— æ³•ä¿æŒ WebSocket è¿æ¥
2. **ä»…æ”¯æŒå®šæ—¶ä»»åŠ¡**ï¼šä¸æ”¯æŒäº¤äº’å¼åŠŸèƒ½
3. **æ•°æ®åŒæ­¥é—®é¢˜**ï¼šä¸ GCP éƒ¨ç½²ä¼šäº§ç”Ÿå†²çª

## æœ€ç»ˆæ–¹æ¡ˆï¼šGCP å•ç‚¹éƒ¨ç½²

- **GCP**: è¿è¡Œå®Œæ•´æœºå™¨äººï¼ˆå®šæ—¶ä»»åŠ¡ + å®æ—¶äº¤äº’ï¼‰
- **GitHub**: ä»…ç”¨äºä»£ç ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶
- **GitHub Actions**: å·²ç¦ç”¨ï¼Œé¿å…ä¸ GCP å†²çª

## éƒ¨ç½²è¿‡ç¨‹ä¸­çš„å…³é”®ä¿®å¤

### 1. ç¯å¢ƒå˜é‡åç§°é—®é¢˜
- **é—®é¢˜**: `.env` ä½¿ç”¨ `FEISHU_APP_ID`ï¼Œä»£ç ä½¿ç”¨ `APP_ID`
- **è§£å†³**: ç»Ÿä¸€ä½¿ç”¨ `APP_ID` å’Œ `APP_SECRET`

### 2. python-dotenv ç¼ºå¤±
- **é—®é¢˜**: ç¨‹åºæ— æ³•è‡ªåŠ¨åŠ è½½ `.env` æ–‡ä»¶
- **è§£å†³**: æ·»åŠ  `python-dotenv` ä¾èµ–ï¼Œåœ¨ç¨‹åºå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½

### 3. lark-oapi SDK ç¼ºå¤±
- **é—®é¢˜**: é£ä¹¦ SDK æœªå®‰è£…
- **è§£å†³**: æ·»åŠ  `lark-oapi` åˆ°éƒ¨ç½²ä¾èµ–

### 4. apt é”æ–‡ä»¶å†²çª
- **é—®é¢˜**: GCP ç³»ç»Ÿè‡ªåŠ¨æ›´æ–°å ç”¨ apt é”
- **è§£å†³**: éƒ¨ç½²è„šæœ¬å¢åŠ ç­‰å¾…æœºåˆ¶

### 5. ä»»åŠ¡æ•°æ®æ–‡ä»¶ç¼ºå¤±
- **é—®é¢˜**: GCP ä¸Šæ²¡æœ‰ `created_tasks.json` å’Œ `task_stats.json`
- **è§£å†³**: åˆ›å»ºåŒæ­¥è„šæœ¬ï¼Œæ ‡è®°ä»»åŠ¡å·²åˆ›å»º

## å·²å®‰è£…çš„ä¾èµ–

```txt
requests>=2.31.0
PyYAML>=6.0.1
pytz>=2023.3
cryptography>=41.0.0
websockets>=11.0
python-dotenv>=1.0.0
lark-oapi
```

## é…ç½®æ–‡ä»¶ä½ç½®

```
~/monthly-report-bot/monthly_report_bot_link_pack/
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ created_tasks.json          # ä»»åŠ¡åˆ›å»ºè®°å½•
â”œâ”€â”€ task_stats.json             # ä»»åŠ¡ç»Ÿè®¡æ•°æ®
â”œâ”€â”€ tasks.yaml                  # ä»»åŠ¡æ¨¡æ¿
â””â”€â”€ venv/                       # Python è™šæ‹Ÿç¯å¢ƒ
```

## systemd æœåŠ¡é…ç½®

**æœåŠ¡åç§°**: `monthly-report-bot`

**æœåŠ¡æ–‡ä»¶**: `/etc/systemd/system/monthly-report-bot.service`

**é…ç½®å†…å®¹**:
```ini
[Unit]
Description=Monthly Report Bot Service
After=network.target network-online.target
Wants=network-online.target

[Service]
Type=simple
User=hdi918072
WorkingDirectory=/home/hdi918072/monthly-report-bot/monthly_report_bot_link_pack
EnvironmentFile=/home/hdi918072/monthly-report-bot/monthly_report_bot_link_pack/.env
ExecStart=/home/hdi918072/monthly-report-bot/monthly_report_bot_link_pack/venv/bin/python3 monthly_report_bot_final_interactive.py
Restart=always
RestartSec=10
StandardOutput=journal
StandardError=journal
SyslogIdentifier=monthly-report-bot

[Install]
WantedBy=multi-user.target
```

## æœºå™¨äººåŠŸèƒ½æ¸…å•

### âœ… å®šæ—¶ä»»åŠ¡ï¼ˆè‡ªåŠ¨æ‰§è¡Œï¼‰

| æ—¶é—´ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| 17-19æ—¥ 09:30 | åˆ›å»ºä»»åŠ¡ | åˆ›å»º24ä¸ªæœˆæŠ¥ä»»åŠ¡ |
| æ¯å¤© 17:30 | æ¯æ—¥ç»Ÿè®¡ | å‘é€ä»»åŠ¡å®Œæˆç»Ÿè®¡ |
| 23æ—¥ 18:00 | æœ€ç»ˆç»Ÿè®¡ | å‘é€æœˆåº¦æ€»ç»“ |

### âœ… å®æ—¶äº¤äº’ï¼ˆ@æœºå™¨äººå›å¤ï¼‰

- **ç»Ÿè®¡æŸ¥è¯¢**: `@æœˆæŠ¥æœºå™¨äºº ç»Ÿè®¡` / `è¿›åº¦` / `å®Œæˆç‡`
- **ä»»åŠ¡åˆ—è¡¨**: `@æœˆæŠ¥æœºå™¨äºº æœªå®Œæˆ` / `è°æ²¡äº¤` / `ä»»åŠ¡åˆ—è¡¨`
- **å¸®åŠ©ä¿¡æ¯**: `@æœˆæŠ¥æœºå™¨äºº å¸®åŠ©` / `?` / `å‘½ä»¤`
- **æ–‡ä»¶é“¾æ¥**: `@æœˆæŠ¥æœºå™¨äºº æ–‡ä»¶` / `é“¾æ¥` / `æ¨¡æ¿`
- **æ—¶é—´å®‰æ’**: `@æœˆæŠ¥æœºå™¨äºº æˆªæ­¢` / `æ—¶é—´` / `æé†’`
- **Echo åŠŸèƒ½**: å…¶ä»–æ–‡æœ¬ä¼šåŸæ ·å›å¤

## å¸¸ç”¨ç»´æŠ¤å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status monthly-report-bot

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u monthly-report-bot -f

# æŸ¥çœ‹æœ€è¿‘æ—¥å¿—
sudo journalctl -u monthly-report-bot -n 100

# é‡å¯æœåŠ¡
sudo systemctl restart monthly-report-bot

# åœæ­¢æœåŠ¡
sudo systemctl stop monthly-report-bot

# å¯åŠ¨æœåŠ¡
sudo systemctl start monthly-report-bot

# æ›´æ–°ä»£ç å¹¶é‡å¯
cd ~/monthly-report-bot
git pull
sudo systemctl restart monthly-report-bot
```

## æ—¥å¿—ä½ç½®

- **systemd æ—¥å¿—**: `sudo journalctl -u monthly-report-bot`
- **åº”ç”¨æ—¥å¿—**: è¾“å‡ºåˆ° systemd journal

## éªŒè¯æ¸…å•

- [x] æœåŠ¡æ­£å¸¸è¿è¡Œ (`Active: active (running)`)
- [x] WebSocket è¿æ¥æˆåŠŸ
- [x] ç¯å¢ƒå˜é‡åŠ è½½æ­£ç¡®
- [x] é£ä¹¦ SDK åˆå§‹åŒ–æˆåŠŸ
- [x] ä»»åŠ¡æ•°æ®æ–‡ä»¶å·²åˆ›å»º
- [x] æœºå™¨äººèƒ½å“åº” `@` æ¶ˆæ¯
- [x] GitHub Actions å·²ç¦ç”¨

## å·²çŸ¥é™åˆ¶

1. **ä»»åŠ¡ç»Ÿè®¡æ˜¾ç¤ºä¸º 0**: 
   - **åŸå› **: æœ¬åœ°æœªåŒæ­¥é£ä¹¦ä¸­çš„å…·ä½“ä»»åŠ¡æ•°æ®
   - **å½±å“**: ä¸å½±å“æœºå™¨äººåŠŸèƒ½ï¼Œåªæ˜¯ç»Ÿè®¡æ•°æ®ä¸å‡†ç¡®
   - **è§£å†³**: ä¸‹æ¬¡è‡ªåŠ¨åˆ›å»ºä»»åŠ¡æ—¶ä¼šåŒæ­¥

2. **æ‰‹åŠ¨åˆ›å»ºçš„ä»»åŠ¡**: 
   - GitHub Actions ä»Šå¤©æ‰‹åŠ¨åˆ›å»ºçš„ä»»åŠ¡ä»åœ¨é£ä¹¦ä¸­
   - ä¸ä¼šå½±å“ GCP æœºå™¨äººè¿è¡Œ
   - ä¸‹æœˆä¼šç”± GCP æœºå™¨äººè‡ªåŠ¨åˆ›å»º

## ä¸‹ä¸€æ­¥å»ºè®®

1. **ç›‘æ§è¿è¡ŒçŠ¶æ€**: å®šæœŸæŸ¥çœ‹æ—¥å¿—ç¡®è®¤æœºå™¨äººæ­£å¸¸è¿è¡Œ
2. **æµ‹è¯•æ‰€æœ‰åŠŸèƒ½**: åœ¨é£ä¹¦ä¸­æµ‹è¯•å„ç§å‘½ä»¤
3. **ç­‰å¾…å®šæ—¶ä»»åŠ¡**: è§‚å¯Ÿä¸‹æ¬¡å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤© 17:30ï¼‰æ˜¯å¦æ­£å¸¸æ‰§è¡Œ
4. **å¤‡ä»½é…ç½®**: ä¿å­˜ `.env` æ–‡ä»¶å†…å®¹ä»¥é˜²ä¸¢å¤±

## æ€»ç»“

âœ… **éƒ¨ç½²æˆåŠŸï¼** æœˆæŠ¥æœºå™¨äººå·²åœ¨ GCP ä¸Š 24/7 è¿è¡Œï¼Œæ”¯æŒï¼š
- è‡ªåŠ¨å®šæ—¶ä»»åŠ¡
- å®æ—¶ `@` å›å¤
- æ‰€æœ‰äº¤äº’åŠŸèƒ½
- å¼€æœºè‡ªå¯åŠ¨
- æœåŠ¡å´©æºƒè‡ªåŠ¨é‡å¯

æ— éœ€æœ¬åœ°ç”µè„‘ä¸€ç›´å¼€æœºï¼Œæœºå™¨äººä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰æœˆæŠ¥ç®¡ç†å·¥ä½œï¼ğŸ‰

---

**éƒ¨ç½²å®Œæˆæ—¶é—´**: 2025-10-18 01:26 (é˜¿æ ¹å»·æ—¶é—´ 22:26)  
**éƒ¨ç½²äººå‘˜**: å±ˆè¶…  
**GCP å®ä¾‹**: monthly-report-bot

