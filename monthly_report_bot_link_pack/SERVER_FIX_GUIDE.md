# æœåŠ¡å™¨ç«¯ä¿®å¤æŒ‡å— - GCPéƒ¨ç½²

## ğŸ“‹ é—®é¢˜
- å·²å®Œæˆä»»åŠ¡æ˜¾ç¤ºä¸º 0
- å®é™…ä¸Šå¾ˆå¤šäººå·²å®Œæˆä»»åŠ¡
- å®Œæˆç‡æ˜¾ç¤º 0.0%

## âœ… å¿«é€Ÿä¿®å¤ï¼ˆ3ä¸ªæ­¥éª¤ï¼‰

### æ­¥éª¤1: ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨

åœ¨æ‚¨çš„æœ¬åœ°Windowsç”µè„‘ä¸Šï¼Œæ‰“å¼€PowerShellæˆ–å‘½ä»¤æç¤ºç¬¦ï¼š

```powershell
# è¿›å…¥é¡¹ç›®ç›®å½•
cd F:\monthly_report_bot_link_pack\monthly_report_bot_link_pack

# ä¸Šä¼ ä¿®å¤æ–‡ä»¶åˆ°æœåŠ¡å™¨
scp monthly_report_bot_ws_v1.1.py hdi918072@34.145.43.77:/home/hdi918072/monthly_report_bot/
scp sync_existing_tasks.py hdi918072@34.145.43.77:/home/hdi918072/monthly_report_bot/
scp fix_on_server.sh hdi918072@34.145.43.77:/home/hdi918072/monthly_report_bot/
```

### æ­¥éª¤2: SSHç™»å½•æœåŠ¡å™¨

```powershell
ssh hdi918072@34.145.43.77
```

### æ­¥éª¤3: åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä¿®å¤è„šæœ¬

```bash
cd /home/hdi918072/monthly_report_bot
chmod +x fix_on_server.sh
./fix_on_server.sh
```

**é¢„æœŸè¾“å‡º**ï¼š
```
============================================================
æœˆæŠ¥æœºå™¨äºº - ä»»åŠ¡åŒæ­¥ä¿®å¤ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰
============================================================

æ­¥éª¤ 1/4: å¤‡ä»½å…³é”®æ–‡ä»¶...
âœ… å·²å¤‡ä»½ä¸»ç¨‹åº -> monthly_report_bot_ws_v1.1.py.backup_20251023_143000
âœ… å·²å¤‡ä»½ä»»åŠ¡æ•°æ® -> task_stats.json.backup_20251023_143000

æ­¥éª¤ 2/4: æ£€æŸ¥å¿…è¦æ–‡ä»¶...
âœ… æ‰€æœ‰å¿…è¦æ–‡ä»¶éƒ½å­˜åœ¨

æ­¥éª¤ 3/4: åŒæ­¥ä»»åŠ¡GUID...
âœ… è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»

æ­£åœ¨è¿è¡ŒåŒæ­¥è„šæœ¬...
----------------------------------------
============================================================
é£ä¹¦ä»»åŠ¡åŒæ­¥å·¥å…·
============================================================
ğŸ“… å½“å‰æœˆä»½: 2025-10
ğŸ“Š æœ¬åœ°ä»»åŠ¡æ•°: 23

ğŸ“‹ æ­£åœ¨è·å–é£ä¹¦ä»»åŠ¡åˆ—è¡¨...
âœ… æˆåŠŸè·å– 23 ä¸ªä»»åŠ¡

ğŸ” åˆ†æé£ä¹¦ä»»åŠ¡...
  âœ… æœˆæŠ¥-å·¥ç¨‹è®¡åˆ’åŠæ‰§è¡Œæƒ…å†µ...
  âœ… æœˆæŠ¥-è®¾è®¡å·¥ä½œè¿›å±•...
  â³ æœˆæŠ¥-ç°åœºæ–½å·¥ç…§ç‰‡...
  ...

âœ… æ‰¾åˆ° 23 ä¸ªæœˆæŠ¥ä»»åŠ¡

ğŸ”„ æ›´æ–° task_stats.json...
  âœ… æœˆæŠ¥-å·¥ç¨‹è®¡åˆ’åŠæ‰§è¡Œæƒ…å†µ (å·²å®Œæˆ)
  âœ… æœˆæŠ¥-è®¾è®¡å·¥ä½œè¿›å±• (å·²å®Œæˆ)
  ...

âœ… task_stats.json å·²æ›´æ–°

============================================================
âœ… åŒæ­¥å®Œæˆï¼
============================================================
ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:
  â€¢ æ€»ä»»åŠ¡æ•°: 23
  â€¢ å·²å®Œæˆ: 9
  â€¢ å¾…å®Œæˆ: 14
  â€¢ å®Œæˆç‡: 39.13%
  â€¢ æ›´æ–°ä»»åŠ¡: 23

ğŸ‰ ç°åœ¨ä»»åŠ¡çŠ¶æ€å·²ä¸é£ä¹¦åŒæ­¥ï¼
----------------------------------------
âœ… ä»»åŠ¡åŒæ­¥æˆåŠŸ

æ­¥éª¤ 4/4: é‡å¯æœˆæŠ¥æœºå™¨äººæœåŠ¡...
âœ… æœåŠ¡é‡å¯å‘½ä»¤å·²æ‰§è¡Œ
âœ… æœåŠ¡è¿è¡Œæ­£å¸¸

============================================================
âœ… ä¿®å¤å®Œæˆï¼
============================================================
```

---

## ğŸ§ª éªŒè¯ä¿®å¤

åœ¨é£ä¹¦ç¾¤èŠä¸­å‘é€ï¼š`çŠ¶æ€`

**æœŸæœ›ç»“æœ**ï¼š
```
ğŸ“Š å½“å‰è¿›åº¦ï¼ˆ2025-10ï¼‰
- æ€»ä»»åŠ¡æ•°: 23
- å·²å®Œæˆ: 9        â† âœ… ä¸å†æ˜¯0ï¼
- å¾…å®Œæˆ: 14
- å®Œæˆç‡: 39.13%   â† âœ… æ­£ç¡®ï¼

ğŸ‘¥ å·²å®Œæˆäººå‘˜:
åˆ˜é‡: 5ä¸ªä»»åŠ¡ ğŸ¥‡
èŒƒæ˜æ°: 1ä¸ªä»»åŠ¡
é»„æ°: 2ä¸ªä»»åŠ¡
ç‹å¤§ä¼Ÿ: 1ä¸ªä»»åŠ¡
```

---

## ğŸ“ è¯¦ç»†æ­¥éª¤è¯´æ˜

### ä¸ºä»€ä¹ˆè¦ä¸Šä¼ è¿™äº›æ–‡ä»¶ï¼Ÿ

1. **monthly_report_bot_ws_v1.1.py** - ä¿®å¤åçš„ä¸»ç¨‹åº
   - ä¿®å¤äº† `create_tasks()` å‡½æ•°
   - ä½¿ç”¨çœŸå®é£ä¹¦APIåˆ›å»ºä»»åŠ¡
   - ä¿å­˜çœŸå®çš„task_guid

2. **sync_existing_tasks.py** - åŒæ­¥å·¥å…·
   - ä»é£ä¹¦è·å–æ‰€æœ‰ä»»åŠ¡
   - åŒ¹é…æœ¬åœ°ä»»åŠ¡
   - æ›´æ–°ä¸ºçœŸå®GUID
   - åŒæ­¥å®ŒæˆçŠ¶æ€

3. **fix_on_server.sh** - è‡ªåŠ¨åŒ–ä¿®å¤è„šæœ¬
   - è‡ªåŠ¨å¤‡ä»½
   - è¿è¡ŒåŒæ­¥
   - é‡å¯æœåŠ¡
   - éªŒè¯ç»“æœ

---

## ğŸ” å¦‚æœé‡åˆ°é—®é¢˜

### é—®é¢˜1: SCPä¸Šä¼ å¤±è´¥

**é”™è¯¯**ï¼š
```
Permission denied (publickey)
```

**è§£å†³**ï¼š
```powershell
# æ–¹æ¡ˆ1: ä½¿ç”¨å¯†ç ç™»å½•ï¼ˆå¦‚æœæœåŠ¡å™¨å…è®¸ï¼‰
scp -o PreferredAuthentications=password monthly_report_bot_ws_v1.1.py hdi918072@34.145.43.77:/home/hdi918072/monthly_report_bot/

# æ–¹æ¡ˆ2: å…ˆSSHç™»å½•ï¼Œç„¶ååœ¨æœåŠ¡å™¨ä¸Šç”¨å…¶ä»–æ–¹å¼è·å–æ–‡ä»¶
# ä¾‹å¦‚ï¼šä»GitHubä¸‹è½½ï¼Œæˆ–ä½¿ç”¨å…¶ä»–ä¼ è¾“æ–¹å¼
```

### é—®é¢˜2: åŒæ­¥è„šæœ¬æ‰¾ä¸åˆ°ä»»åŠ¡

**é”™è¯¯**ï¼š
```
æœªæ‰¾åˆ°ä»»ä½•é£ä¹¦ä»»åŠ¡
```

**åŸå› **ï¼š
- é£ä¹¦åº”ç”¨æƒé™ä¸è¶³
- .env æ–‡ä»¶ä¸­çš„å‡­è¯ä¸æ­£ç¡®

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥ .env æ–‡ä»¶
cat .env | grep FEISHU

# ç¡®è®¤åº”ç”¨æƒé™
# éœ€è¦æƒé™ï¼štask:task:readonly, task:task
```

### é—®é¢˜3: æœåŠ¡é‡å¯å¤±è´¥

**é”™è¯¯**ï¼š
```
âŒ æœåŠ¡å¯åŠ¨å¤±è´¥
```

**è§£å†³**ï¼š
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
sudo journalctl -u monthly-report-bot -n 50

# æ£€æŸ¥è¯­æ³•é”™è¯¯
python3 -m py_compile monthly_report_bot_ws_v1.1.py

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
cd /home/hdi918072/monthly_report_bot
source venv/bin/activate
python3 monthly_report_bot_ws_v1.1.py
```

---

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœä¿®å¤åå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å›æ»šï¼š

```bash
# SSHç™»å½•æœåŠ¡å™¨
ssh hdi918072@34.145.43.77

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/hdi918072/monthly_report_bot

# æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
ls -la *.backup_*

# å›æ»šï¼ˆæ›¿æ¢æ—¶é—´æˆ³ä¸ºå®é™…å¤‡ä»½æ–‡ä»¶çš„æ—¶é—´æˆ³ï¼‰
cp monthly_report_bot_ws_v1.1.py.backup_20251023_143000 monthly_report_bot_ws_v1.1.py
cp task_stats.json.backup_20251023_143000 task_stats.json

# é‡å¯æœåŠ¡
sudo systemctl restart monthly-report-bot
```

---

## ğŸ“Š ä¿®å¤åŸç†

### é—®é¢˜æ ¹æº

**æ—§ä»£ç **ï¼ˆæ¨¡æ‹Ÿåˆ›å»ºï¼‰ï¼š
```python
task_id = f"task_2025-10_1"  # âŒ å‡ID
update_task_completion(task_id, ...)
```

**åŒæ­¥å¤±è´¥**ï¼š
```python
# ç”¨å‡IDæŸ¥è¯¢é£ä¹¦API
is_completed = await check_task_status_from_feishu("task_2025-10_1")
# é£ä¹¦è¿”å›ï¼šä»»åŠ¡ä¸å­˜åœ¨
# ç»“æœï¼šcompleted æ°¸è¿œæ˜¯ False
```

### ä¿®å¤æ–¹æ¡ˆ

**æ–°ä»£ç **ï¼ˆçœŸå®åˆ›å»ºï¼‰ï¼š
```python
response = await lark_client.task.v2.task.acreate(request)
task_guid = response.data.task.guid  # âœ… çœŸå®GUID
update_task_completion(task_guid, ...)
```

**åŒæ­¥å·¥å…·**ï¼ˆä¿®å¤å·²å­˜åœ¨ä»»åŠ¡ï¼‰ï¼š
```python
# 1. ä»é£ä¹¦è·å–æ‰€æœ‰ä»»åŠ¡
feishu_tasks = await list_all_tasks(client)

# 2. åŒ¹é…æ ‡é¢˜ï¼Œè·å–çœŸå®GUID
for task in feishu_tasks:
    if task.summary == "2025-10 æœˆæŠ¥-å·¥ç¨‹è®¡åˆ’åŠæ‰§è¡Œæƒ…å†µ":
        real_guid = task.guid  # âœ… çœŸå®GUID
        is_completed = task.complete == 2  # âœ… çœŸå®çŠ¶æ€

# 3. æ›´æ–°æœ¬åœ°æ•°æ®
new_tasks[real_guid] = old_task_info
new_tasks[real_guid]["completed"] = is_completed
```

---

## âœ… ä¿®å¤æ£€æŸ¥æ¸…å•

æ‰§è¡Œå®Œä¿®å¤åï¼Œè¯·ç¡®è®¤ï¼š

- [ ] fix_on_server.sh è„šæœ¬æˆåŠŸè¿è¡Œ
- [ ] åŒæ­¥è„šæœ¬æ˜¾ç¤ºæ‰¾åˆ° 23 ä¸ªä»»åŠ¡
- [ ] åŒæ­¥è„šæœ¬æ˜¾ç¤ºæ­£ç¡®çš„å·²å®Œæˆæ•°é‡ï¼ˆä¾‹å¦‚ 9 ä¸ªï¼‰
- [ ] æœåŠ¡æˆåŠŸé‡å¯
- [ ] å‘é€`çŠ¶æ€`æ˜¾ç¤ºæ­£ç¡®çš„å·²å®Œæˆæ•°ï¼ˆä¸å†æ˜¯0ï¼‰
- [ ] å‘é€`å›¾è¡¨`èƒ½çœ‹åˆ°å‡†ç¡®ç»Ÿè®¡
- [ ] å·²å®Œæˆäººå‘˜æ’è¡Œæ¦œæ˜¾ç¤ºæ­£ç¡®

**å…¨éƒ¨æ‰“âœ…** â†’ ä¿®å¤æˆåŠŸï¼ğŸ‰

---

## ğŸ“ éœ€è¦å¸®åŠ©

### æŸ¥çœ‹æœåŠ¡æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹
sudo journalctl -u monthly-report-bot -f

# æœ€æ–°50è¡Œ
sudo journalctl -u monthly-report-bot -n 50

# æŸ¥çœ‹é”™è¯¯
sudo journalctl -u monthly-report-bot -p err -n 20
```

### æ‰‹åŠ¨æµ‹è¯•åŒæ­¥

```bash
cd /home/hdi918072/monthly_report_bot
source venv/bin/activate
python3 sync_existing_tasks.py
```

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
sudo systemctl status monthly-report-bot
```

---

## ğŸ¯ æ€»ç»“

### æ‚¨éœ€è¦åšçš„ï¼ˆ3æ­¥ï¼‰

1. **æœ¬åœ°ä¸Šä¼ æ–‡ä»¶**ï¼š
   ```powershell
   scp monthly_report_bot_ws_v1.1.py hdi918072@34.145.43.77:/home/hdi918072/monthly_report_bot/
   scp sync_existing_tasks.py hdi918072@34.145.43.77:/home/hdi918072/monthly_report_bot/
   scp fix_on_server.sh hdi918072@34.145.43.77:/home/hdi918072/monthly_report_bot/
   ```

2. **SSHç™»å½•æœåŠ¡å™¨**ï¼š
   ```powershell
   ssh hdi918072@34.145.43.77
   ```

3. **è¿è¡Œä¿®å¤è„šæœ¬**ï¼š
   ```bash
   cd /home/hdi918072/monthly_report_bot
   chmod +x fix_on_server.sh
   ./fix_on_server.sh
   ```

### é¢„è®¡è€—æ—¶
- ä¸Šä¼ æ–‡ä»¶: 30ç§’
- è¿è¡Œä¿®å¤: 1-2åˆ†é’Ÿ
- **æ€»è®¡**: çº¦3åˆ†é’Ÿ

### ä¿®å¤æ•ˆæœ
- âœ… ä»»åŠ¡å®ŒæˆçŠ¶æ€æ­£ç¡®åŒæ­¥
- âœ… å®Œæˆç‡å‡†ç¡®æ˜¾ç¤ºï¼ˆ39.13%è€Œé0%ï¼‰
- âœ… æ¯æ—¥æé†’åª@æœªå®Œæˆäººå‘˜
- âœ… å›¾è¡¨ç»Ÿè®¡å‡†ç¡®

---

**ä¿®å¤å®Œæˆåï¼Œè¯·åœ¨é£ä¹¦ç¾¤èŠå‘é€ `çŠ¶æ€` éªŒè¯æ•ˆæœï¼**
