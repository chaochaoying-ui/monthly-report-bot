#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
å‡çº§åˆ°å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬
åŒ…å«ä»»åŠ¡ç»Ÿè®¡å’Œæ–‡æœ¬äº¤äº’åŠŸèƒ½
"""

import os
import sys
import shutil
from pathlib import Path

def backup_current_version():
    """å¤‡ä»½å½“å‰ç‰ˆæœ¬"""
    current_file = "monthly_report_bot_official.py"
    backup_file = "monthly_report_bot_official_backup.py"
    
    if os.path.exists(current_file):
        shutil.copy2(current_file, backup_file)
        print(f"âœ… å·²å¤‡ä»½å½“å‰ç‰ˆæœ¬: {backup_file}")
        return True
    else:
        print(f"âŒ å½“å‰ç‰ˆæœ¬æ–‡ä»¶ä¸å­˜åœ¨: {current_file}")
        return False

def upgrade_to_full_version():
    """å‡çº§åˆ°å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬"""
    source_file = "monthly_report_bot_ws_v1.1.py"
    target_file = "monthly_report_bot_official.py"
    
    if not os.path.exists(source_file):
        print(f"âŒ å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬æ–‡ä»¶ä¸å­˜åœ¨: {source_file}")
        return False
    
    # å¤åˆ¶å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬
    shutil.copy2(source_file, target_file)
    print(f"âœ… å·²å‡çº§åˆ°å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬: {target_file}")
    return True

def create_upgraded_start_script():
    """åˆ›å»ºå‡çº§åçš„å¯åŠ¨è„šæœ¬"""
    script_content = """@echo off
echo å¯åŠ¨æœˆæŠ¥æœºå™¨äººå®Œæ•´åŠŸèƒ½ç‰ˆæœ¬...
echo åŒ…å«åŠŸèƒ½ï¼š
echo - å®šæ—¶ä»»åŠ¡å‘é€
echo - ä»»åŠ¡å®Œæˆç»Ÿè®¡
echo - æ–‡æœ¬äº¤äº’åŠŸèƒ½
echo - æ™ºèƒ½æ„å›¾è¯†åˆ«
echo - å¤šè¯­è¨€æ”¯æŒ
echo.

cd /d "C:\\Users\\Administrator\\Desktop\\monthly_report_bot_link_pack"
python monthly_report_bot_official.py
pause
"""
    
    with open("start_full_version.bat", "w", encoding="utf-8") as f:
        f.write(script_content)
    
    print("âœ… å·²åˆ›å»ºå®Œæ•´åŠŸèƒ½ç‰ˆæœ¬å¯åŠ¨è„šæœ¬: start_full_version.bat")

def create_feature_comparison():
    """åˆ›å»ºåŠŸèƒ½å¯¹æ¯”æ–‡æ¡£"""
    comparison_content = """# ğŸš€ æœˆæŠ¥æœºå™¨äººå®Œæ•´åŠŸèƒ½ç‰ˆæœ¬å‡çº§è¯´æ˜

## âœ… å‡çº§å®Œæˆ

### æ–°ç‰ˆæœ¬åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½æ¨¡å— | åŸç‰ˆæœ¬ | å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬ |
|---------|--------|-------------|
| å®šæ—¶ä»»åŠ¡å‘é€ | âœ… | âœ… |
| æ–°æˆå‘˜æ¬¢è¿ | âœ… | âœ… |
| ä»»åŠ¡å®Œæˆç»Ÿè®¡ | âŒ | âœ… |
| æ–‡æœ¬äº¤äº’åŠŸèƒ½ | âŒ | âœ… |
| æ™ºèƒ½æ„å›¾è¯†åˆ« | âŒ | âœ… |
| å¤šè¯­è¨€æ”¯æŒ | âŒ | âœ… |
| ç”¨æˆ·ç”»åƒåˆ†æ | âŒ | âœ… |
| å®æ—¶äº¤äº’ | âŒ | âœ… |

## ğŸ¯ æ–°å¢åŠŸèƒ½è¯¦è§£

### 1. ä»»åŠ¡å®Œæˆç»Ÿè®¡åŠŸèƒ½ âœ…
- **ä»»åŠ¡çŠ¶æ€è·Ÿè¸ª**ï¼šå®æ—¶è·Ÿè¸ªæ¯ä¸ªä»»åŠ¡çš„å®ŒæˆçŠ¶æ€
- **å®Œæˆç‡ç»Ÿè®¡**ï¼šè‡ªåŠ¨è®¡ç®—ä»»åŠ¡å®Œæˆç‡
- **ç»Ÿè®¡æŠ¥å‘Š**ï¼šç”Ÿæˆè¯¦ç»†çš„ç»Ÿè®¡æŠ¥å‘Š
- **è¿›åº¦å¯è§†åŒ–**ï¼šå›¾è¡¨å±•ç¤ºä»»åŠ¡è¿›åº¦

### 2. æ–‡æœ¬äº¤äº’åŠŸèƒ½ âœ…
- **è‡ªç„¶è¯­è¨€ç†è§£**ï¼šç†è§£ç”¨æˆ·çš„æ–‡æœ¬æ¶ˆæ¯
- **æ™ºèƒ½å›å¤**ï¼šæ ¹æ®ç”¨æˆ·æ„å›¾æä¾›ç›¸åº”å›å¤
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€è¥¿ç­ç‰™è¯­
- **ä¸Šä¸‹æ–‡ç†è§£**ï¼šè®°ä½å¯¹è¯ä¸Šä¸‹æ–‡

### 3. æ™ºèƒ½äº¤äº’åŠŸèƒ½ âœ…
- **æ„å›¾è¯†åˆ«**ï¼šè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·æ„å›¾
- **æ™ºèƒ½å»ºè®®**ï¼šæä¾›ä¸ªæ€§åŒ–å»ºè®®
- **ç”¨æˆ·ç”»åƒ**ï¼šåˆ†æç”¨æˆ·è¡Œä¸ºæ¨¡å¼
- **è‡ªé€‚åº”å­¦ä¹ **ï¼šæ ¹æ®äº¤äº’å†å²ä¼˜åŒ–å“åº”

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬
```bash
# ä½¿ç”¨æ–°çš„å¯åŠ¨è„šæœ¬
start_full_version.bat

# æˆ–ç›´æ¥è¿è¡Œ
python monthly_report_bot_official.py
```

### æ–‡æœ¬äº¤äº’ç¤ºä¾‹
ç”¨æˆ·å¯ä»¥åœ¨ç¾¤èŠä¸­å‘é€ä»¥ä¸‹æ¶ˆæ¯ï¼š
- "æŸ¥çœ‹æˆ‘çš„ä»»åŠ¡"
- "æ ‡è®°ä»»åŠ¡å®Œæˆ"
- "ç”³è¯·ä»»åŠ¡å»¶æœŸ"
- "æŸ¥çœ‹å¸®åŠ©"
- "æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯"

### ä»»åŠ¡ç»Ÿè®¡åŠŸèƒ½
- è‡ªåŠ¨è·Ÿè¸ªä»»åŠ¡å®ŒæˆçŠ¶æ€
- ç”Ÿæˆæœˆåº¦ç»Ÿè®¡æŠ¥å‘Š
- æä¾›è¿›åº¦å¯è§†åŒ–å›¾è¡¨

## ğŸ“Š æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒæ¨¡å—
1. **WebSocketå¤„ç†å™¨**ï¼šå®æ—¶äº‹ä»¶å¤„ç†
2. **æ™ºèƒ½äº¤äº’å¼•æ“**ï¼šè‡ªç„¶è¯­è¨€ç†è§£å’Œæ„å›¾è¯†åˆ«
3. **ä»»åŠ¡ç®¡ç†æ¨¡å—**ï¼šä»»åŠ¡çŠ¶æ€è·Ÿè¸ªå’Œç»Ÿè®¡
4. **å¡ç‰‡è®¾è®¡æ¨¡å—**ï¼šä¸“ä¸šçº§äº¤äº’å¡ç‰‡

### æ•°æ®å­˜å‚¨
- **ä»»åŠ¡çŠ¶æ€**ï¼š`created_tasks.json`
- **äº¤äº’æ—¥å¿—**ï¼š`interaction_log.json`
- **ç”¨æˆ·ç”»åƒ**ï¼šå†…å­˜å­˜å‚¨ï¼Œæ”¯æŒæŒä¹…åŒ–

## ğŸ‰ å‡çº§å®Œæˆ

**æ­å–œï¼æ‚¨çš„æœˆæŠ¥æœºå™¨äººå·²æˆåŠŸå‡çº§åˆ°å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬ï¼**

ç°åœ¨æ‚¨å¯ä»¥äº«å—ï¼š
- ğŸ¯ æ™ºèƒ½æ–‡æœ¬äº¤äº’
- ğŸ“Š ä»»åŠ¡å®Œæˆç»Ÿè®¡
- ğŸŒ å¤šè¯­è¨€æ”¯æŒ
- ğŸ¤– æ™ºèƒ½æ„å›¾è¯†åˆ«
- ğŸ“ˆ è¿›åº¦å¯è§†åŒ–

---
**å‡çº§æ—¶é—´**ï¼š2025-08-23
**ç‰ˆæœ¬**ï¼šv1.1 å®Œæ•´åŠŸèƒ½ç‰ˆ
**çŠ¶æ€**ï¼šâœ… å‡çº§æˆåŠŸ
"""
    
    with open("UPGRADE_COMPLETE.md", "w", encoding="utf-8") as f:
        f.write(comparison_content)
    
    print("âœ… å·²åˆ›å»ºå‡çº§å®Œæˆè¯´æ˜: UPGRADE_COMPLETE.md")

def main():
    """ä¸»å‡½æ•°"""
    print("="*60)
    print("ğŸš€ æœˆæŠ¥æœºå™¨äººå®Œæ•´åŠŸèƒ½ç‰ˆæœ¬å‡çº§å·¥å…·")
    print("="*60)
    
    # å¤‡ä»½å½“å‰ç‰ˆæœ¬
    if not backup_current_version():
        return
    
    # å‡çº§åˆ°å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬
    if not upgrade_to_full_version():
        return
    
    # åˆ›å»ºå‡çº§åçš„å¯åŠ¨è„šæœ¬
    create_upgraded_start_script()
    
    # åˆ›å»ºåŠŸèƒ½å¯¹æ¯”æ–‡æ¡£
    create_feature_comparison()
    
    print("\n" + "="*60)
    print("ğŸ‰ å‡çº§å®Œæˆï¼")
    print("="*60)
    print("âœ… å·²å‡çº§åˆ°å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬")
    print("âœ… å·²å¤‡ä»½åŸç‰ˆæœ¬")
    print("âœ… å·²åˆ›å»ºæ–°å¯åŠ¨è„šæœ¬: start_full_version.bat")
    print("âœ… å·²åˆ›å»ºå‡çº§è¯´æ˜: UPGRADE_COMPLETE.md")
    print("\nğŸ“‹ æ–°åŠŸèƒ½åŒ…æ‹¬ï¼š")
    print("- ä»»åŠ¡å®Œæˆç»Ÿè®¡")
    print("- æ–‡æœ¬äº¤äº’åŠŸèƒ½")
    print("- æ™ºèƒ½æ„å›¾è¯†åˆ«")
    print("- å¤šè¯­è¨€æ”¯æŒ")
    print("- ç”¨æˆ·ç”»åƒåˆ†æ")
    print("\nğŸš€ ç°åœ¨å¯ä»¥è¿è¡Œ start_full_version.bat å¯åŠ¨å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬ï¼")
    print("="*60)

if __name__ == "__main__":
    main()
