# === 月报机器人项目 - Cursor AI 规则 ===
# 本文件定义了AI助手在本项目中的行为规范

## 项目信息
- 项目类型：Python 飞书机器人
- Python版本：3.11
- 主要框架：飞书开放平台 SDK、WebSocket

## 代码规范
- 使用中文注释和文档字符串
- 遵循PEP 8代码风格
- 使用black格式化器（行长度120）
- 使用ruff进行代码检查
- 所有函数必须包含完整的类型注解（typing模块）
- 变量命名：使用有意义的中文拼音或英文名称

## 错误处理
- 所有网络请求（飞书API调用）必须包含try-except异常处理
- 所有文件I/O操作必须处理异常
- 使用logging模块记录日志，禁止使用print调试
- 日志级别：DEBUG用于调试，INFO用于关键操作，ERROR用于异常

## 飞书机器人特定规则
- 飞书卡片中的@标签格式：`<at id="用户ID">显示名称</at>`（不是open_id或user_id）
- WebSocket连接必须实现心跳检测和断线重连
- 消息处理必须检查是否@机器人（避免过度响应）
- 任务完成关键词：已完成、已更新、搞定、done等
- 所有卡片发送前必须验证JSON格式

## 测试要求
- 使用pytest进行测试
- 新功能必须包含单元测试
- 测试文件放在tests/目录
- 测试覆盖率目标：>80%
- 不要创建临时测试脚本（除非用户明确要求）

## 依赖管理
- 新增依赖必须添加到requirements_v1_1.txt
- 标注版本号以确保兼容性
- 优先使用标准库，避免引入不必要的第三方库

## 文件组织
- 核心代码在根目录和app/目录
- 工具脚本放在scripts/目录
- 文档放在docs/目录
- 测试放在tests/目录
- 禁止修改：migrations/**（除非任务明确涉及）

## 数据文件
- tasks.yaml：任务定义文件
- task_stats.json：任务统计数据
- created_tasks.json：已创建任务记录
- 读写JSON文件时使用UTF-8编码

## 安全规则
- 敏感信息（APP_ID、APP_SECRET等）必须从环境变量读取
- 禁止在代码中硬编码密钥
- 禁止提交包含敏感信息的日志文件

## 响应规范
- 默认不输出解释性文字，直接实现
- 代码变更使用统一diff格式
- 变更最小化原则（Minimal Diff）
- 每次改动说明回退方案

## AI助手行为
- 积极实现而非仅建议
- 优先使用专用工具而非终端命令
- 并行调用独立的工具以提高效率
- 复杂任务创建TODO列表跟踪进度
- 发现与记忆矛盾的信息时立即更新记忆

## 当前项目状态
- 主程序：monthly_report_bot_final_interactive.py
- 已实现：@检测、智能任务完成标记、任务查询、统计报告
- WebSocket长连接版本：v1.1
- 支持飞书消息事件、卡片交互、定时任务



